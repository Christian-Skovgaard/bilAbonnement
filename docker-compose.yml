services:
  gateway:
    container_name: gateway
    build:
      context: ./APIGateway # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    ports:
      - "5001:5001" # Map the container port to the host port
    volumes:
      - ./APIGateway:/app # Mount the local directory to the container
    depends_on:
      - authorization-db # Wait for the mongo service to be ready
      - authorization-service
    networks:
      - frontend-net
      - backend-net

  frontend:
    container_name: frontend
    build:
      context: ./Frontend
      dockerfile: Dockerfile
    ports:
      - "8501:8501"
    volumes:
      - ./Frontend:/app
    depends_on:
      - gateway
    networks:
      - frontend-net

  car-catalog-service:
    container_name: car-catalog-service
    build:
      context: ./CarCatalogService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment:
      MONGO_URI: "mongodb://car-catalog-db:27017/car-catalog-db" # Use the service name as the hostname
    volumes:
      - ./CarCatalogService/Service:/app # Mount the local directory to the container
    depends_on:
      - car-catalog-db # Wait for the mongo service to be ready
    networks:
      - backend-net

  car-catalog-db:
    container_name: car-catalog-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - car-catalog-db:/data/db # Persist the data locally
      - ./CarCatalogService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net      

  authorization-service:
    container_name: authorization-service
    build:
      context: ./AuthorizationService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    volumes:
      - ./AuthorizationService/Service:/app # Mount the local directory to the container
    depends_on:
      - authorization-db # Wait for the mongo service to be ready
    networks:
      - backend-net      

  authorization-db:
    container_name: authorization-db
    image: mysql:latest # Use the latest MongoDB image
    environment:
      MYSQL_ROOT_PASSWORD: password # super sikkert
      MYSQL_DATABASE: user_db
      MYSQL_USER: admin
      MYSQL_PASSWORD: MegaIsbj√∏rn
    volumes:
      - authorization-db:/data/db # Persist the data locally
      - ./AuthorizationService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net      

  customer-support-service:
    container_name: customer-support-service
    build:
      context: ./CustomerSupportService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment:
      MONGO_URI: "mongodb://customer-service-db:27019/customer-service-db" # Use the service name as the hostname
    volumes:
      - ./CustomerSupportService/Service:/app # Mount the local directory to the container
    depends_on:
      - customer-service-db # Wait for the mongo service to be ready
    networks:
      - backend-net  

  customer-service-db:
    container_name: customer-service-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - customer-service-db:/data/db # Persist the data locally
      - ./CustomerSupportService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net    


  damage-registration-service:
    container_name: damage-registration-service
    build:
      context: ./DamageRegistrationService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment:
      MONGO_URI: "mongodb://damage-registration-db:27017/damage-registration-db" # Use the service name as the hostname
    volumes:
      - ./DamageRegistrationService/Service:/app # Mount the local directory to the container
    depends_on:
      - car-catalog-db # Wait for the mongo service to be ready
    networks:
      - backend-net

  damage-registration-db:
    container_name: damage-registration-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - damage-registration-db:/data/db # Persist the data locally
      - ./DamageRegistrationService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net  

  subscription-management-service:
    container_name: subscription-management-service
    build:
      context: ./SubscriptionManagementService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment:
      MONGO_URI: "mongodb://subscription-management-db:27017/subscriptionDB" # Use the service name as the hostname
    volumes:
      - ./SubscriptionManagementService/Service:/app # Mount the local directory to the container
    depends_on:
      - customer-service-db # Wait for the mongo service to be ready
    networks:
      - backend-net  

  subscription-management-db:
    container_name: subscription-management-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - subscription-management-db:/data/db # Persist the data locally
      - ./SubscriptionManagementService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net
    
  customer-management-service:
    container_name: customer-management-service
    build:
      context: ./CustomerManagementService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment:
      MONGO_URI: "mongodb://customer-management-db:27017/customerDB" # Use the service name as the hostname
    volumes:
      - ./CustomerManagementService/Service:/app # Mount the local directory to the container
    depends_on:
      - customer-service-db # Wait for the mongo service to be ready
    networks:
      - backend-net  

  customer-management-db:
    container_name: customer-management-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - customer-management-db:/data/db # Persist the data locally
      - ./CustomerManagementService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net

  task-management-service:
    container_name: task-management-service
    build:
      context: ./TaskManagementService/Service # Use the local directory as the build context
      dockerfile: Dockerfile # Use the Dockerfile in the local directory
    environment: 
      MONGO_URI: "mongodb://task-management-db:27020/task-management-db" # Use the service name as the hostname
    volumes:
      - ./TaskManagementService/Service:/app # Mount the local directory to the container
    depends_on:
      - task-management-db # Wait for the mongo service to be ready
    networks:
      - backend-net

  task-management-db:
    container_name: task-management-db
    image: mongo:latest # Use the latest MongoDB image
    volumes:
      - task-management-db:/data/db # Persist the data locally
      - ./TaskManagementService/Database/init:/docker-entrypoint-initdb.d
    networks:
      - backend-net


volumes:
  car-catalog-db:
    driver: local
  authorization-db:
    driver: local
  customer-service-db:
    driver: local
  customer-management-db:
    driver: local
  damage-registration-db:
    driver: local
  subscription-management-db:
    driver: local
  task-management-db:
    driver: local



networks:
  frontend-net:
    driver: bridge
  backend-net:
    driver: bridge
